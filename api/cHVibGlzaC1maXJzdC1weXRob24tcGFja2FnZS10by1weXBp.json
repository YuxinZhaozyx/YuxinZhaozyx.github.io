{"title":"发布第一个python包到PyPI","date":"2020-03-01T15:04:41.000Z","thumbnail":"publish-first-python-package-to-pypi/logo.png","link":"publish-first-python-package-to-pypi","comments":true,"tags":["python"],"categories":["tools"],"updated":"2022-01-04T08:35:48.623Z","content":"<p>本文介绍如何将python包发布到PyPI上。</p>\n<a id=\"more\"></a>\n\n<h2 id=\"关于setup-py\">关于<code>setup.py</code><a href=\"publish-first-python-package-to-pypi#关于setup-py\"></a></h2><ul>\n<li>确保你当前的根目录下能找到<code>setup.py</code>。</li>\n<li><code>version</code> 最好符合语义化版本号规则，如1.2.0</li>\n</ul>\n<p><strong>模板:</strong></p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> setuptools <span class=\"keyword\">import</span> setup, find_packages</span><br><span class=\"line\"></span><br><span class=\"line\">setup(</span><br><span class=\"line\">    name = <span class=\"string\">'&lt;your package name&gt;'</span>,</span><br><span class=\"line\">    version = <span class=\"string\">'0.1.0'</span>,</span><br><span class=\"line\">    author = <span class=\"string\">'&lt;your name&gt;'</span>,</span><br><span class=\"line\">    author_email = <span class=\"string\">'your@your_mail'</span>,</span><br><span class=\"line\">    packages = find_packages(),</span><br><span class=\"line\">    url = <span class=\"string\">'https://github.com/&lt;your repo&gt;'</span>,</span><br><span class=\"line\">    license = <span class=\"string\">'LICENSE'</span>,  <span class=\"comment\"># refer to your LICENSE file</span></span><br><span class=\"line\">    description = <span class=\"string\">'&lt;short description&gt;'</span>,</span><br><span class=\"line\">    long_description = open(<span class=\"string\">'README.md'</span>).read(),</span><br><span class=\"line\">    python_requires = <span class=\"string\">'&gt;=3'</span>,</span><br><span class=\"line\">    install_requires = [</span><br><span class=\"line\">        <span class=\"string\">\"&lt;package required&gt; &gt;= 1.3.0\"</span>,</span><br><span class=\"line\">    ]</span><br><span class=\"line\">)</span><br></pre></td></tr></table></div></figure>\n\n<h2 id=\"本地打包\">本地打包<a href=\"publish-first-python-package-to-pypi#本地打包\"></a></h2><figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python setup.py sdist bdist_wheel</span><br></pre></td></tr></table></div></figure>\n\n<p>该命令会在本地建立<code>dist</code>目录用于存放生成的包。</p>\n<ul>\n<li><code>sdist</code> 会生成一个包含源码的包，用户获取后会在本地重新编译构建。</li>\n<li><code>bdist_wheel</code> 会生成一个预编译的<code>.whl</code> 文件。</li>\n</ul>\n<h2 id=\"创建PyPI账号\">创建PyPI账号<a href=\"publish-first-python-package-to-pypi#创建PyPI账号\"></a></h2><p>分别在<a href=\"https://pypi.org\" target=\"_blank\" rel=\"noopener\">官网</a>和<a href=\"https://test.pypi.org\" target=\"_blank\" rel=\"noopener\">另一用于测试的网站</a>注册一个账号，记得就算成功登陆了账号也要到注册的邮箱点开那个激活的邮件。</p>\n<h2 id=\"创建用户验证文件\">创建用户验证文件<a href=\"publish-first-python-package-to-pypi#创建用户验证文件\"></a></h2><p>在用户目录下新建文件 <code>~/.pypirc</code>，加入以下内容:</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">[distutils]</span></span><br><span class=\"line\"><span class=\"attr\">index-servers</span>=</span><br><span class=\"line\">\tpypi</span><br><span class=\"line\">\ttestpypi</span><br><span class=\"line\">\t</span><br><span class=\"line\"><span class=\"section\">[pypi]</span></span><br><span class=\"line\"><span class=\"attr\">repository</span> = https://upload.pypi.org/legacy/</span><br><span class=\"line\"><span class=\"attr\">username</span> = &lt;username in pypi.org&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">[testpypi]</span></span><br><span class=\"line\"><span class=\"attr\">repository</span> = https://test.pypi.org/legacy/</span><br><span class=\"line\"><span class=\"attr\">username</span> = &lt;username in test.pypi.org&gt;</span><br></pre></td></tr></table></div></figure>\n\n<h2 id=\"上传到测试网站\">上传到测试网站<a href=\"publish-first-python-package-to-pypi#上传到测试网站\"></a></h2><p>首先安装一个工具<a href=\"https://github.com/pypa/twine\" target=\"_blank\" rel=\"noopener\">twine</a>。</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install twine</span><br></pre></td></tr></table></div></figure>\n\n<p>接下来可以通过twine上传生成的包文件。</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">twine upload -r testpypi dist/*</span><br><span class=\"line\"># or</span><br><span class=\"line\">twine upload --repository-url https://test.pypi.org/legacy/ dist/*</span><br></pre></td></tr></table></div></figure>\n\n<p>下载安装一下试试：</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install -i https://test.pypi.org/simple &lt;your package&gt;</span><br></pre></td></tr></table></div></figure>\n\n<p>确认没有问题、能够正常使用后我们就可以进行下一步了。</p>\n<h2 id=\"上传到PyPI\">上传到PyPI<a href=\"publish-first-python-package-to-pypi#上传到PyPI\"></a></h2><p>步骤同测试网站，但是目标地址换成了 <code>https://upload.pypi.org/legacy/</code>。</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">twine upload -r pypi dist/*</span><br><span class=\"line\"># or</span><br><span class=\"line\">twine upload --repository-url https://upload.pypi.org/legacy/ dist/*</span><br></pre></td></tr></table></div></figure>\n\n<p>接下来就可以愉快地从PyPI安装了。</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pip install &lt;your package&gt;</span><br></pre></td></tr></table></div></figure>\n\n","prev":{"title":"easycore多GPU并行加速","link":"easycore-parallel-multi-gpu"},"next":{"title":"python多进程及pytorch多GPU并行推断","link":"python-multi-gpu-multiprocessing"},"plink":"https://yuxinzhao.net/publish-first-python-package-to-pypi/","toc":[{"title":"关于<code>setup.py</code>","id":"关于setup-py","index":"1"},{"title":"本地打包","id":"本地打包","index":"2"},{"title":"创建PyPI账号","id":"创建PyPI账号","index":"3"},{"title":"创建用户验证文件","id":"创建用户验证文件","index":"4"},{"title":"上传到测试网站","id":"上传到测试网站","index":"5"},{"title":"上传到PyPI","id":"上传到PyPI","index":"6"}],"reward":true,"copyright":{"author":"Yuxin Zhao","link":"<a href=\"https://yuxinzhao.net/publish-first-python-package-to-pypi/\" title=\"发布第一个python包到PyPI\">https://yuxinzhao.net/publish-first-python-package-to-pypi/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow noopener\" target=\"_blank\">CC BY-NC-ND 4.0</a>)"}}