{"title":"Linux nohup 后台执行指令","date":"2019-10-21T00:09:18.000Z","link":"linux-command-nohup","comments":true,"tags":["command"],"categories":["linux"],"updated":"2022-01-04T08:35:48.595Z","content":"<p>通常情况下，执行 Linux 指令必须终端一直开着才能指令执行下去，直到指令执行完成，才会结束。<code>nohup</code> 指令可以让指令在后台执行，而不需要操作者一直等待其执行完成，即使操作者登出指令依然会继续执行。</p>\n<a id=\"more\"></a>\n\n<p>nohup 全程为 no hangup。 hangup (HUP) 信号会在用户登出时由系统发出，通知所有进程结束，但通过 <code>nohup</code> 执行的指令，HUP信号会被 <code>nohup</code> 拦截，从而让指令继续执行。</p>\n<h1 id=\"后台运行\">后台运行<a href=\"linux-command-nohup#后台运行\"></a></h1><figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nohup your-command &amp;</span><br></pre></td></tr></table></div></figure>\n\n<p><code>nohup</code> 默认会将输出重定向到  nohup.out  文件，注意默认是将输出追加到文件尾。</p>\n<p>可以通过 <code>tail</code> 指令自动”即时”显示最新的输出。</p>\n<p><strong>注：</strong> 不一定能看到即时的输出，因为 stdout 通常有缓存，只有缓存满了才会写到输出文件中</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tail -f nohup.out</span><br></pre></td></tr></table></div></figure>\n\n<p>也可以自已重定向输出到指定文件。</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nohup your-command &gt; output.file 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></div></figure>\n\n<h2 id=\"以低优先级执行\">以低优先级执行<a href=\"linux-command-nohup#以低优先级执行\"></a></h2><p>因为使用 <code>nohup</code> 执行的指令一般都是要跑很久的，用户登出后继续运行，有时候可能占用太多的系统资源，我们可以结合 <code>nice</code> 指令让指令以较低优先级在后台执行，尽量不影响其他正常指令的执行。</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nohup nice your-command &amp;</span><br></pre></td></tr></table></div></figure>\n\n<h1 id=\"查看后台进程\">查看后台进程<a href=\"linux-command-nohup#查看后台进程\"></a></h1><p>由于 <code>nohup</code> 指令在后台执行，要查看及终止后台进程都需要先获取该进程的 pid。</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jobs -l</span><br></pre></td></tr></table></div></figure>\n\n<p><strong>输出样例：</strong> </p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[1]+   490 Running    nohup go run main.go &amp;</span><br></pre></td></tr></table></div></figure>\n\n<p>其中，1 是任务标识 job-spec，490 是进程的 pid。</p>\n<p>注： <code>jobs</code> 命令在重新登录后就无法查看后台进程了，可以使用 <code>top</code> 指令查看所有进程。</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">top</span><br></pre></td></tr></table></div></figure>\n\n<h1 id=\"终止后台进程\">终止后台进程<a href=\"linux-command-nohup#终止后台进程\"></a></h1><figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kill your-nohup-pid</span><br></pre></td></tr></table></div></figure>\n\n<h1 id=\"将后台程序移到前台\">将后台程序移到前台<a href=\"linux-command-nohup#将后台程序移到前台\"></a></h1><figure class=\"highlight\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fg your-nohup-job-spec</span><br></pre></td></tr></table></div></figure>\n\n<p><strong>注：</strong>虽然移到了前台，但 stdout 仍是带缓存的，只有等缓冲区满了，输出才会刷新到屏幕上。</p>\n","prev":{"title":"Warshall 算法求解传递闭包","link":"warshall"},"next":{"title":"Pickle Python对象序列化","link":"pickle"},"plink":"https://yuxinzhao.net/linux-command-nohup/","toc":[{"title":"后台运行","id":"后台运行","index":"1","children":[{"title":"以低优先级执行","id":"以低优先级执行","index":"1.1"}]},{"title":"查看后台进程","id":"查看后台进程","index":"2"},{"title":"终止后台进程","id":"终止后台进程","index":"3"},{"title":"将后台程序移到前台","id":"将后台程序移到前台","index":"4"}],"reward":true,"copyright":{"author":"Yuxin Zhao","link":"<a href=\"https://yuxinzhao.net/linux-command-nohup/\" title=\"Linux nohup 后台执行指令\">https://yuxinzhao.net/linux-command-nohup/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow noopener\" target=\"_blank\">CC BY-NC-ND 4.0</a>)"}}